"use strict";(this.webpackChunkSituInspector=this.webpackChunkSituInspector||[]).push([[208],{208:(e,t,o)=>{o.r(t),o.d(t,{collectMcpOperationsForElement:()=>l,generateMcpOperations:()=>s,transformEditToMcpOperations:()=>i,transformLayoutToMcpOperations:()=>c});var r=o(55),a=o(865);function n(e,t,o,r={}){if(!o||o.length<2)return"";const a=o.map(e=>{const t=e.hex||"#000000",o=null!=e.opacity?e.opacity:1,r=null!=e.position?e.position:0;if(o<1){const e=function(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}(t);if(e)return`rgba(${e.r}, ${e.g}, ${e.b}, ${o}) ${r}%`}return`${t} ${r}%`}).join(", ");return"linear"===e?`linear-gradient(${t}deg, ${a})`:"radial"===e?`radial-gradient(${r.radialShape||"circle"} ${r.radialSize||"farthest-corner"} at ${r.radialPosition||"center"}, ${a})`:"conic"===e?`conic-gradient(from ${t}deg at ${r.conicPosition||"center"}, ${a})`:""}function i(e){try{"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("situ:mcp:transform:start",{detail:{editId:e&&e.key,timestamp:e&&e.timestamp}}))}catch(e){}const t=[];let o=null;try{try{const e=require("./utils/themeDetector.js");e&&e.resolveTheme&&(o=e.resolveTheme(localStorage.getItem("situ-apply-theme")||"auto"))}catch(e){}if(!o){const e=localStorage.getItem("situ-apply-theme")||"auto";o="auto"===e?window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e}}catch(e){o=null}const i=[];return e&&e.changes&&e.changes.states&&Object.keys(e.changes.states).forEach(t=>{e.changes.states[t]&&(e.changes.states[t].fill||e.changes.states[t].properties?.fill||e.changes.states[t].appearance||e.changes.states[t].typography||e.changes.states[t].border||e.changes.states[t].layout)&&i.push(t)}),0===i.length&&e&&e.changes&&(e.changes.fill||e.changes.appearance||e.changes.typography||e.changes.border||e.changes.layout)&&i.push("default"),i.forEach(i=>{const s=function(e,t="default"){const[o,r,a]=(e.source||"").split(":");let n=[],i=[`[data-id="${e.elementId}"]`];if(e.cssClasses&&Array.isArray(e.cssClasses))n=e.cssClasses.filter(e=>e&&e.trim().length>0);else try{const t=document.querySelector(`[data-id="${e.elementId}"]`);t&&t.className&&(n=t.className.trim().split(/\s+/).filter(e=>e.length>0))}catch(e){}const s=e&&"page"===e.type;s&&(i=["body"],n=[]),!s&&n.length>0&&(i=[`.${n.join(".")}`,`[data-id="${e.elementId}"]`,`.${n[0]}[data-id="${e.elementId}"]`]);const l="hover"===t?"pseudo":s?"element":"class",c=s?"body":n.length>0?`.${n.join(".")}`:`[data-id="${e.elementId}"]`;return{editId:e.key,target:{file:o,line:Number(r)||0,column:Number(a)||0,elementId:s?"body":e.elementId,selectors:s?["body"]:[`[data-id="${e.elementId}"]`],cssClasses:n},scope:{state:t,selectorKind:l,selector:c},allSelectors:i}}(e,i);let l=0;function c(t){const r=t.context?.layer||0,a={id:`${e.key}-${i}-${l++}`,idePath:s.target.file?`src/${s.target.file}`:"",action:t.operation,change:{before:t.before,after:t.after},scope:{layer:r,state:s.scope.state,selectorKind:s.scope.selectorKind,selector:s.scope.selector},locator:{strategy:"jsx_opening_loc",line:s.target.line,column:s.target.column,elementId:s.target.elementId,cssClasses:s.target.cssClasses,selectors:s.allSelectors},context:t.context||{},codePath:t.codePath||void 0};try{o&&(a.context={...a.context||{},applyToTheme:o})}catch(e){}return a}const d=e.changes&&e.changes.states&&e.changes.states[i]?e.changes.states[i]:"default"===i&&e.changes?{...e.changes||{},...e.changes.properties||{}}:{},u=e.updated&&e.updated.states&&e.updated.states[i]?e.updated.states[i]:"default"===i&&e.updated?{...e.updated||{},...e.updated.properties||{}}:{},p=e.original&&e.original.states&&e.original.states[i]?e.original.states[i]:"default"===i&&e.original?{...e.original||{},...e.original.properties||{}}:{};if("page"===e.type&&"default"===i){const o=d.appearance||e.changes&&e.changes.appearance||null;if(o){const e=p.appearance?.pageBackgroundColor||p.appearance?.backgroundColor||null,r=u.appearance?.pageBackgroundColor||u.appearance?.backgroundColor||null;("pageBackgroundColor"in o||"backgroundColor"in o)&&null!=r&&t.push(c({operation:"update_body_fill",before:e,after:r,codePath:"document.body.style.backgroundColor",context:{}}));const a="number"==typeof p.appearance?.pageBackgroundOpacity?p.appearance.pageBackgroundOpacity:"number"==typeof p.appearance?.opacity?p.appearance.opacity:null,n="number"==typeof u.appearance?.pageBackgroundOpacity?u.appearance.pageBackgroundOpacity:"number"==typeof u.appearance?.opacity?u.appearance.opacity:null;("pageBackgroundOpacity"in o||"opacity"in o)&&null!=n&&t.push(c({operation:"update_body_opacity",before:a,after:n,codePath:"document.body.style.backgroundColor",context:{}}))}}d.border&&u.border&&"none"===u.border.mode&&t.push(c({operation:"remove_border",before:p.border||null,after:{mode:"none",width:0,edge:u.border.edge||"all"},context:{}})),Array.isArray(d.fill)&&Array.isArray(u.fill)&&0===u.fill.length&&t.push(c({operation:"remove_fill",before:p.fill||null,after:[],context:{}}));const f=Array.isArray(d.fill)?d.fill:d.properties&&Array.isArray(d.properties.fill)?d.properties.fill:null,g=Array.isArray(u.fill)?u.fill:u.properties&&Array.isArray(u.properties.fill)?u.properties.fill:null;let b=Array.isArray(p.fill)?p.fill:p.properties&&Array.isArray(p.properties.fill)?p.properties.fill:null;try{if((!b||0===b.length)&&s&&s.target&&s.target.elementId){const t=document.querySelector(`[data-id="${s.target.elementId}"]`);if(t){const o=(0,a.getBaselineFillsForElement)(t,e)||[];o&&o.length>0&&(b=o)}}}catch(e){}if(Array.isArray(g)&&Array.isArray(b)&&g.length>b.length){const o=e=>e&&(e.hex||e)?e.hex||e:null,r=o(b[0]);if(r){const a=g.findIndex(e=>o(e)===r);if(a>0){for(let o=0;o<a;o++){const r=g[o];t.push(c({operation:"insert_fill_layer",before:null,after:r,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),layer:o,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}}))}const o=new Array(a).fill(null);b=o.concat(b)}}}f&&Array.isArray(f)&&f.forEach((o,r)=>{const a=g&&g[r]||null,i=b&&b[r]||null;if(!a||!o)return;const l=null!=o.mode?o.mode:a&&a.mode||i&&i.mode;if(o.mode&&i&&o.mode!==i.mode){if("gradient"===o.mode&&a.type){const o=a.type,l=a.angle||0,d=a.stops||[];if(d.length>=2){const u=i.hex||"#000000",p=n(o,l,d,{radialShape:a.radialShape,radialSize:a.radialSize,radialPosition:a.radialPosition,conicPosition:a.conicPosition});t.push(c({operation:"update_fill_gradient",codePath:"element.style.backgroundImage",before:u,after:p,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),layer:r,gradientType:o,angle:l,stops:d.length,cssClasses:s.target.cssClasses,allSelectors:s.allSelectors}}))}return}if("solid"===o.mode&&"gradient"===i.mode){const o=a.hex||"#000000",l=n(i.type||"linear",i.angle||0,i.stops||[],{radialShape:i.radialShape,radialSize:i.radialSize,radialPosition:i.radialPosition,conicPosition:i.conicPosition});return void t.push(c({operation:"update_fill_color",codePath:"element.style.backgroundColor",before:l,after:o,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),layer:r,originalMode:"gradient",newMode:"solid",newHex:o,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}}))}}if("solid"===l&&(!i||"solid"===i.mode)){const n=i&&i.hex,l=a.hex;l&&l!==n&&t.push(c({operation:"update_fill_color",codePath:"element.style.backgroundColor",before:n,after:l,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),layer:r,originalHex:n,newHex:l,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}})),null!=o.opacity&&i&&Number(o.opacity)!==Number(i.opacity)&&t.push(c({operation:"update_fill_opacity",codePath:"element.style.opacity",before:i.opacity,after:o.opacity,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),layer:r,originalOpacity:i.opacity,newOpacity:o.opacity,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}}))}if(("gradient"===o.mode||"gradient"===l)&&Array.isArray(o.stops)){const o=i?n(i.type||"linear",i.angle||0,i.stops||[],{radialShape:i.radialShape,radialSize:i.radialSize,radialPosition:i.radialPosition,conicPosition:i.conicPosition}):"",l=n(a.type||"linear",a.angle||0,a.stops||[],{radialShape:a.radialShape,radialSize:a.radialSize,radialPosition:a.radialPosition,conicPosition:a.conicPosition});l&&l!==o&&t.push(c({operation:"update_fill_gradient",codePath:"element.style.backgroundImage",before:o,after:l,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),layer:r,gradientType:a.type||"linear",angle:a.angle||0,stops:(a.stops||[]).length,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}}))}if(!(null==o.angle||o.stops&&Array.isArray(o.stops))){const o=a.type||i&&i.type||"linear",l={radialShape:a.radialShape||i&&i.radialShape,radialSize:a.radialSize||i&&i.radialSize,radialPosition:a.radialPosition||i&&i.radialPosition,conicPosition:a.conicPosition||i&&i.conicPosition},d=i&&i.angle||0,u=n(o,d,i&&i.stops||a.stops||[],l),p=n(o,a.angle||0,a.stops||[],l);(a.angle||0)!==d&&t.push(c({operation:"update_fill_gradient_angle",codePath:"element.style.backgroundImage",before:u,after:p,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),layer:r,originalAngle:d,newAngle:a.angle||0,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}}))}});const y=d.layout||"default"===i&&e.changes&&e.changes.layout||null;if(y)try{const o={};if(p&&"object"==typeof p.layout&&Object.keys(y).forEach(e=>{void 0!==p.layout[e]&&(o[e]=p.layout[e])}),Object.keys(o).length<Object.keys(y).length){const t=e.original&&e.original.states?.default?.layout||{};Object.keys(y).forEach(e=>{void 0===o[e]&&void 0!==t[e]&&(o[e]=t[e])})}if(Object.keys(o).length<Object.keys(y).length)try{const t=document.querySelector(`[data-id="${s.target.elementId}"]`);if(t){const r=(0,a.getBaselineLayoutForElement)(t,e)||{};Object.keys(y).forEach(e=>{void 0===o[e]&&void 0!==r[e]&&(o[e]=r[e])})}}catch(e){}const n=(0,r.$N)(o,y);Object.entries(n).forEach(([o,{before:r,after:a}])=>{const n=`update_layout_${o}`;t.push(c({operation:n,codePath:`element.style.${o}`,before:r,after:a,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),property:o,state:i,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}}))})}catch(e){}const m=d.appearance||"default"===i&&e.changes&&e.changes.appearance||null,_=p.appearance||p.properties?.appearance||"default"===i&&e.original&&(e.original.appearance||e.original.states?.default?.appearance||e.original.states?.default?.properties?.appearance)||null;if(m){const o=!(!0!==(u&&u.appearance||{}).borderRadiusSplit&&!0!==m.borderRadiusSplit);Object.entries(m).forEach(([r,a])=>{if("page"===e.type&&("pageBackgroundColor"===r||"pageBackgroundOpacity"===r||"backgroundColor"===r||"opacity"===r))return;if(("borderRadiusTopLeft"===r||"borderRadiusTopRight"===r||"borderRadiusBottomLeft"===r||"borderRadiusBottomRight"===r)&&!o)return;if("borderRadius"===r&&o)return;const n=function(e){return{borderRadius:"borderRadius",borderRadiusTopLeft:"borderTopLeftRadius",borderRadiusTopRight:"borderTopRightRadius",borderRadiusBottomLeft:"borderBottomLeftRadius",borderRadiusBottomRight:"borderBottomRightRadius",opacity:"opacity"}[e]||e}(r),i=function(e){return{borderRadius:"update_border_radius",borderRadiusTopLeft:"update_border_top_left",borderRadiusTopRight:"update_border_top_right",borderRadiusBottomLeft:"update_border_bottom_left",borderRadiusBottomRight:"update_border_bottom_right",borderRadiusSplit:"update_border_radius_split",opacity:"update_opacity"}[e]||`update_${e}`}(r),l=_?_[r]:void 0,d=a;void 0!==l&&void 0!==d&&("object"==typeof l||"object"==typeof d?JSON.stringify(l)===JSON.stringify(d):Number.isFinite(l)&&Number.isFinite(d)?Number(l)===Number(d):String(l)===String(d))||t.push(c({operation:i,codePath:`element.style.${n}`,before:l,after:d,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),property:r,originalValue:l,newValue:d,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}}))})}const h=d.typography||"default"===i&&e.changes&&e.changes.typography||null,S=p.typography||p.properties?.typography||"default"===i&&e.original&&(e.original.typography||e.original.states?.default?.typography||e.original.states?.default?.properties?.typography)||null;h&&(u&&u.typography,Object.entries(h).forEach(([o,r])=>{const a=function(e){return{fontFamily:"fontFamily",fontSize:"fontSize",fontWeight:"fontWeight",lineHeight:"lineHeight",letterSpacing:"letterSpacing",textAlign:"textAlign",verticalAlign:"verticalAlign",color:"color",colorOpacity:"color"}[e]||e}(o),n=function(e){return{fontFamily:"update_font_family",fontSize:"update_font_size",fontWeight:"update_font_weight",lineHeight:"update_line_height",letterSpacing:"update_letter_spacing",textAlign:"update_text_align",verticalAlign:"update_vertical_align",color:"update_text_color",colorOpacity:"update_text_opacity"}[e]||`update_${e}`}(o),l=S?S[o]:void 0,d=r;void 0!==l&&void 0!==d&&("object"==typeof l||"object"==typeof d?JSON.stringify(l)===JSON.stringify(d):Number.isFinite(l)&&Number.isFinite(d)?Number(l)===Number(d):String(l)===String(d))||t.push(c({operation:n,codePath:`element.style.${a}`,before:l,after:d,locator:{elementId:e.elementId,source:e.source},scope:{state:i},context:{suggestedCssSelectors:s.suggestedCssSelectors}}))}));const $=d.border||"default"===i&&e.changes&&e.changes.border||null,C=p.border||p.properties?.border||"default"===i&&e.original&&e.original.states?.default?.border||{};if($){const o=$,r=C||{},a=u.border||u.properties?.border||"default"===i&&e.updated&&e.updated.states?.default?.border||{};if(Object.prototype.hasOwnProperty.call(o,"opacity")&&null!=a.opacity&&null!=r.opacity&&Number(a.opacity)!==Number(r.opacity)&&t.push(c({operation:"update_border_opacity",codePath:"element.style.borderColor",before:r.opacity,after:a.opacity,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),originalOpacity:r.opacity,newOpacity:a.opacity,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}})),Object.prototype.hasOwnProperty.call(o,"edge")&&"string"==typeof o.edge&&o.edge!==r.edge&&t.push(c({operation:"update_border_edge",codePath:"element.style.borderWidth",before:r.edge||"all",after:o.edge,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),originalEdge:r.edge||"all",newEdge:o.edge,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}})),Object.prototype.hasOwnProperty.call(o,"hex")&&void 0!==a.hex&&void 0!==r.hex&&a.hex!==r.hex&&t.push(c({operation:"update_border_color",codePath:"element.style.borderColor",before:r.hex,after:a.hex,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),originalColor:r.hex,newColor:a.hex,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}})),Object.prototype.hasOwnProperty.call(o,"width")&&null!=a.width){const o="number"==typeof r.width?r.width:0,n=Number(a.width);n!==o&&t.push(c({operation:"update_border_width",codePath:"element.style.borderWidth",before:`${o}px`,after:`${n}px`,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),originalWidth:o,newWidth:n,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}}))}if(Object.prototype.hasOwnProperty.call(o,"style")&&a.style&&a.style!==r.style&&t.push(c({operation:"update_border_style",codePath:"element.style.borderStyle",before:r.style,after:a.style,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),originalStyle:r.style,newStyle:a.style,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}})),"gradient"===$.mode&&$.stops&&Array.isArray($.stops)){const o=$.type||"linear",a=$.angle||0,i=$.stops;if(i.length>=2){const l="gradient"===r.mode?n(r.type||"linear",r.angle||0,r.stops||[]):r.hex||"#000000",d=n(o,a,i);t.push(c({operation:"update_border_gradient",codePath:"element.style.borderImage",before:l,after:d,context:{timestamp:new Date(e.timestamp||Date.now()).toISOString(),gradientType:o,angle:a,stops:i.length,cssClasses:s.target.cssClasses,suggestedCssSelectors:s.suggestedCssSelectors}}))}}}}),t}function s(e){return Array.isArray(e)?e.flatMap(e=>i(e)):[]}function l(e){try{const t=localStorage.getItem("situ-edits");if(!t)return[];const o=JSON.parse(t);return o&&Array.isArray(o.editsArray)?o.editsArray.filter(t=>t&&t.elementId===e).flatMap(e=>i(e)):[]}catch(e){return[]}}function c(e,t,o){const n=[],i=e.updated?.states||{};return Object.entries(i).forEach(([i,s])=>{if(s.layout)try{let l=e.original?.states?.[i]?.layout||{};if(0===Object.keys(l).length)try{const o=document.querySelector(`[data-id="${t}"]`);o&&(l=(0,a.getBaselineLayoutForElement)(o,e))}catch(e){}const c=(0,r.$N)(l,s.layout);Object.entries(c).forEach(([r,{before:a,after:s}],l)=>{const[c,d,u]=(o||"").split(":"),p=parseInt(d)||1,f=parseInt(u)||1;let g=[];try{const e=document.querySelector(`[data-id="${t}"]`);e&&e.className&&(g=e.className.trim().split(/\s+/).filter(e=>e.length>0))}catch(e){}const b=g.length>0?[`.${g.join(".")}`,`[data-id="${t}"]`]:[`[data-id="${t}"]`];n.push({id:`${e.key}-${i}-layout-${l}`,action:`update_layout_${r}`,change:{before:a,after:s},scope:{property:r,state:i,selectorKind:"element_id",selector:t},locator:{strategy:"jsx_opening_loc",line:p,column:f,elementId:t,cssClasses:g,selectors:b}})})}catch(e){}}),n}"undefined"!=typeof window&&(window.__situMcp={transformEditToMcpOperations:i,generateMcpOperations:s,collectMcpOperationsForElement:l,transformLayoutToMcpOperations:c})}}]);